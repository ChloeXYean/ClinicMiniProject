<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ClinicMiniProject.UI.Doctor.ConsultationDetailsPage"
             Shell.NavBarIsVisible="False"
             Title="ConsultationDetails">
    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">

        <Grid Grid.Row="0" ColumnDefinitions="Auto,*" Padding="20,15" BackgroundColor="#6EA8FE">
            <ImageButton Grid.Column="0" Source="back.png" HeightRequest="22" WidthRequest="22" BackgroundColor="Transparent" Clicked="OnBackClicked" />
            <Label Grid.Column="1" Text="Consultation Details" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" />
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16,12" Spacing="10">

                <!-- No Appointment Message -->
                <Border BackgroundColor="#ffccccff" StrokeThickness="0" Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="No Appointment for this time slot" 
                               FontAttributes="Bold" 
                               FontSize="16" 
                               TextColor="#5b0000ff"
                               HorizontalOptions="Center" />
                        <Label Text="Please select an appointment from the schedule to view next consultation details." 
                               FontSize="14" 
                               TextColor="#850404ff"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                    <Border.Triggers>
                        <DataTrigger TargetType="Border" Binding="{Binding HasAppointment}" Value="True">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </Border.Triggers>
                </Border>

                <!-- Appointment Details -->
                <Border BackgroundColor="#F5F7FF" StrokeThickness="0" Padding="12"
                        IsVisible="{Binding HasAppointment}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Patient Name:" FontAttributes="Bold" FontSize="14" />
                        <Label Text="{Binding CurrentDetails.PatientName}" FontSize="14" />
                        
                        <Label Text="IC Number:" FontAttributes="Bold" FontSize="14" Margin="0,8,0,0" />
                        <Label Text="{Binding CurrentDetails.PatientIc}" FontSize="14" />
                        
                        <Label Text="Appointment Time:" FontAttributes="Bold" FontSize="14" Margin="0,8,0,0" />
                        <Label Text="{Binding CurrentDetails.AppointedTimeSlot, StringFormat='{0:h:mm tt}'}" FontSize="14" />
                    </VerticalStackLayout>
                </Border>

                <Border BackgroundColor="#FFFFFF" StrokeThickness="0" Padding="12"
                        IsVisible="{Binding IsConsultationStarted}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Remark:" FontAttributes="Bold" FontSize="14" />
                        <Editor Text="{Binding ConsultationRemark, Mode=TwoWay}"
                                Placeholder="type your remark"
                                AutoSize="TextChanges"
                                HeightRequest="120"
                                FontSize="14" />
                    </VerticalStackLayout>
                </Border>

                <Button Text="Start Conversation"
                        Command="{Binding StartConsultationCommand}"
                        HeightRequest="48"
                        Margin="0,8,0,0"
                        IsVisible="{Binding HasAppointment}">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsConsultationStarted}" Value="True">
                            <Setter Property="IsVisible" Value="False" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

                <Button Text="End Consultation"
                        Command="{Binding EndConsultationCommand}"
                        HeightRequest="48"
                        Margin="0,8,0,0"
                        IsVisible="{Binding IsConsultationStarted}" />

            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="2" HeightRequest="0" />
    </Grid>
</ContentPage>
