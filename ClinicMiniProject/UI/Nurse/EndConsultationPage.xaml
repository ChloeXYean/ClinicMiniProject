<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:ClinicMiniProject.UI.Control"
             xmlns:viewmodels="clr-namespace:ClinicMiniProject.ViewModels"
             
             xmlns:sys="clr-namespace:System;assembly=mscorlib" 
             
             x:Class="ClinicMiniProject.UI.Nurse.EndConsultationPage"
             BackgroundColor="White"
             NavigationPage.HasNavigationBar="False">

    <Grid RowDefinitions="Auto, *">

        <controls:BackNavBar BackCommand="{Binding BackCommand}" Title="End Doctor Consultation" />

        <VerticalStackLayout Grid.Row="1" Padding="20" Spacing="20">

            <Label Text="{Binding Source={x:Static sys:DateTime.Now}, StringFormat='Date: {0:dd MMMM yyyy}'}" 
                   TextColor="Black" 
                   FontSize="14" 
                   Margin="5,0,0,0"/>

            <CollectionView x:Name="ConsultationsList" ItemsSource="{Binding ActiveConsultations}">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border BackgroundColor="#EEEEEE"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 15"
                                Padding="15">

                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.5" Radius="5" Offset="2,2"/>
                            </Border.Shadow>

                            <Grid RowDefinitions="Auto, Auto, Auto, Auto" ColumnDefinitions="Auto, *">

                                <Image Grid.Row="0" Grid.Column="0" Source="person.png" HeightRequest="20" VerticalOptions="Center"/>
                                <Label Grid.Row="0" Grid.Column="1" 
                                       Text="{Binding PatientName, StringFormat='Patient Name: {0}'}" 
                                       TextColor="Black" FontAttributes="Bold" FontSize="14" VerticalOptions="Center" Margin="10,0,0,0"/>

                                <Label Grid.Row="1" Grid.Column="1" 
                                       TextColor="#555555" FontSize="12" Margin="10,2,0,0">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding PatientIC}" />
                                            <Span Text=" | " />
                                            <Span Text="{Binding ServiceType}" TextColor="#2D5AF0" FontAttributes="Italic"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Image Grid.Row="2" Grid.Column="0" Source="clock.png" HeightRequest="15" VerticalOptions="Center" Margin="2,10,0,0"/>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="1" Spacing="5" Margin="10,10,0,0" VerticalOptions="Center">
                                    <Label Text="{Binding Date}" TextColor="Black" FontSize="13"/>
                                    <Label Text="-" TextColor="Black" FontSize="13"/>
                                    <Label Text="{Binding AppointedTime}" TextColor="Black" FontAttributes="Bold" FontSize="13"/>
                                </HorizontalStackLayout>

                                <Label Grid.Row="3" Grid.Column="1" 
                                       Text="End Consultation" 
                                       TextColor="#E02D2D" FontSize="12" FontAttributes="Bold" TextDecorations="Underline" HorizontalOptions="End" Margin="0,15,0,0">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EndConsultationViewModel}}, Path=CompleteCommand}"
                                                              CommandParameter="{Binding .}"/>
                                    </Label.GestureRecognizers>
                                </Label>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </Grid>
</ContentPage>