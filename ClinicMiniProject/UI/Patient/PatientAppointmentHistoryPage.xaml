<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:control="clr-namespace:ClinicMiniProject.UI.Control"
    x:Class="ClinicMiniProject.UI.Patient.PatientAppointmentHistoryPage"
    Title="Appointment History"
    Shell.NavBarIsVisible="False"
    BackgroundColor="#F5F7FA">

	<Grid RowDefinitions="Auto, Auto, *">
		<!-- Back Navigation Bar -->
		<control:BackNavBar Grid.Row="0" Title="Appointment History" BackCommand="{Binding BackCommand}"/>

		<!-- Search Bar Area -->
		<Grid Grid.Row="1" ColumnDefinitions="*, Auto" Padding="20,10">
			<Frame BackgroundColor="White" CornerRadius="20" Padding="10,0" HasShadow="True" HorizontalOptions="Fill" Grid.Column="0" HeightRequest="40" BorderColor="Transparent">
				<Grid ColumnDefinitions="Auto, *">
					<Label Text="ðŸ”" VerticalOptions="Center" Margin="10,0" FontSize="16"/>
					<Entry Grid.Column="1"
                           Placeholder="Search Doctor Name"
                           Text="{Binding SearchText}"
                           TextColor="#333"
                           PlaceholderColor="Gray"
                           FontSize="14"
                           VerticalOptions="Center"/>
				</Grid>
			</Frame>
			<ImageButton Grid.Column="1" Source="filter_icon.png" WidthRequest="24" HeightRequest="24" Margin="10,0,0,0" VerticalOptions="Center"/>
		</Grid>

		<!-- Conditional Display: No History OR Appointment List -->
		<Grid Grid.Row="2">
			<!-- No History Display -->
			<VerticalStackLayout IsVisible="{Binding HasNoAppointments}"
                                  HorizontalOptions="Center"
                                  VerticalOptions="Center"
                                  Spacing="20">

				<Image Source="calendar_icon.png"
                       WidthRequest="120"
                       HeightRequest="120"
                       HorizontalOptions="Center" />

				<Label Text="No History"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="#333"
                       HorizontalOptions="Center" />

				<Label Text="Your past appointments will be shown here"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center" />
			</VerticalStackLayout>

			<!-- Appointment List -->
			<CollectionView ItemsSource="{Binding Appointments}"
                             Margin="20,0"
                             IsVisible="{Binding HasAppointments}">
				<CollectionView.ItemsLayout>
					<LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
				</CollectionView.ItemsLayout>
				<CollectionView.ItemTemplate>
					<DataTemplate>
						<Frame BackgroundColor="{Binding CardBackgroundColor}"
                               CornerRadius="15"
                               HasShadow="True"
                               Padding="15"
                               BorderColor="Transparent">
							<Grid RowDefinitions="Auto, Auto, Auto, Auto" ColumnDefinitions="*, Auto" RowSpacing="8">

								<!-- Row 0: Time and Date -->
								<VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="2">
									<Label Text="{Binding Time}" FontAttributes="Bold" FontSize="15" TextColor="#333"/>
									<Label Text="{Binding Date}" FontSize="11" TextColor="#666"/>
								</VerticalStackLayout>

								<Frame Grid.Row="0" Grid.Column="1"
                                       BackgroundColor="{Binding BadgeColor}"
                                       CornerRadius="10"
                                       Padding="10,4"
                                       HasShadow="False"
                                       VerticalOptions="Start"
                                       HorizontalOptions="End"
                                       BorderColor="Transparent">
									<Label Text="{Binding Status}" FontSize="10" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
								</Frame>

								<!-- Row 1: Doctor Info -->
								<HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2" Spacing="8" VerticalOptions="Center">
									<Label Text="ðŸ‘¨â€âš•ï¸" FontSize="16" VerticalOptions="Center"/>
									<Label Text="{Binding DoctorName}" FontAttributes="Bold" FontSize="14" TextColor="#333" VerticalOptions="Center"/>
								</HorizontalStackLayout>

								<!-- Row 2: Details -->
								<Label Grid.Row="2" Grid.ColumnSpan="2" Text="{Binding Details}" FontSize="12" TextColor="#555"/>

								<!-- Row 3: Action Buttons -->
								<HorizontalStackLayout Grid.Row="3" Grid.ColumnSpan="2"
                                                       Spacing="10" HorizontalOptions="Center" Margin="0,10,0,0">

									<Button Text="Cancel Appointment"
                                            FontSize="12"
                                            FontAttributes="Bold"
                                            HeightRequest="36"
                                            Padding="20,0"
                                            BackgroundColor="#FF4D4D"
                                            TextColor="White"
                                            CornerRadius="18"
                                            IsVisible="{Binding IsCancellable}"
                                            Command="{Binding CancelCommand}"
                                            VerticalOptions="Center"/>
								</HorizontalStackLayout>
							</Grid>
						</Frame>
					</DataTemplate>
				</CollectionView.ItemTemplate>
				<CollectionView.Footer>
					<BoxView HeightRequest="20" Color="Transparent"/>
				</CollectionView.Footer>
			</CollectionView>
		</Grid>
	</Grid>
</ContentPage>